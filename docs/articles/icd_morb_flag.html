<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Using `WAACHShelp::icd_morb_flag` in practice • WAACHShelp</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.7.1/jquery.min.js" integrity="sha512-v2CJ7UaYy4JwqLDIrZUI/4hqeoQieOmAZNXBeQyjo21dadnwR+8ZaIJVT8EE2iyI61OV8e6M8PP2/4hpQINQ/g==" crossorigin="anonymous" referrerpolicy="no-referrer"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Using `WAACHShelp::icd_morb_flag` in practice">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">


    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">WAACHShelp</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">1.2.2</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Articles

    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/aducust_flag.html">Flagging aducust records using `aducust_flag`</a>
    </li>
    <li>
      <a href="../articles/create_markdown.html">Creating a blank Quarto markdown document</a>
    </li>
    <li>
      <a href="../articles/create_project.html">Creating an R project</a>
    </li>
    <li>
      <a href="../articles/icd_morb_flag.html">Using `WAACHShelp::icd_morb_flag` in practice</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right"></ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->



      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Using <code>WAACHShelp::icd_morb_flag</code> in
practice</h1>
            
      

      <div class="hidden name"><code>icd_morb_flag.Rmd</code></div>

    </div>

    
    
<div class="section level2">
<h2 id="setup">Setup<a class="anchor" aria-label="anchor" href="#setup"></a>
</h2>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Load the package</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">WAACHShelp</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="data-requirements">Data requirements<a class="anchor" aria-label="anchor" href="#data-requirements"></a>
</h2>
<p><code>icd_morb_flag</code> has two dataframe inputs:
<code>data</code>, and <code>dobmap</code>.</p>
<ul>
<li>
<code>data</code>
<ul>
<li>A hospital morbidity dataset.</li>
<li>All we really require of this data set is:
<ul>
<li>Some sort of ID value to differentiate visits within an individual
(e.g., rootnum, NEWUID).</li>
<li>Some sort of date variable (only necessary if flagging whether a
visit occurred below a certain age).</li>
<li>The set of flagging variable(s) to search for ICD codes across. It
does not matter what these flagging variables are called.</li>
</ul>
</li>
</ul>
</li>
<li>
<code>dobmap</code>
<ul>
<li>A DOBmap file.</li>
<li>All we really require of this data set is two columns.
<ul>
<li>Some sort of ID variable.</li>
<li>Some sort of dob variable.</li>
</ul>
</li>
<li>The DOB variable can be called whatever we like. As a default, it is
called “dob”, after the date of birth variable in the DOBmap files.</li>
<li>Other variables can be carried across from DOBmap file. These can be
specified in <code>dobmap_other_vars</code>.</li>
</ul>
</li>
</ul>
<p>The ID variable of the DOBmap file must be called the same thing as
in the <code>data</code> file. This is the variable that the joining is
based on.</p>
<p>By default, we assume the <code>rootnum</code> variable exists in
both data sets. It does not matter what this variable is called in
reality—the <code>id_var</code> argument can be specified to any
string.</p>
</div>
<div class="section level2">
<h2 id="flagging">Flagging<a class="anchor" aria-label="anchor" href="#flagging"></a>
</h2>
<p>Flagging can be handled automatically, or via manual specification
via <code>flag_category</code>.</p>
<p><code>icd_morb_flag</code> can flag only one variable at a time.
“Multiple flagging” (of multiple distinct variables) can be handled via
for-loop.</p>
<p>For the purpose of this vignette, the following
parameters/assumptions will be made:</p>
<ol style="list-style-type: decimal">
<li>Morbidity data set is called <code>morb_dat</code>.</li>
<li>DOBmap data set (if applicable) is called
<code>dobmap_dat</code>.</li>
<li>Want to create the <code>MH_morb</code> flag (unless othewise
specified).</li>
</ol>
<div class="section level3">
<h3 id="automatic-flagging">Automatic flagging<a class="anchor" aria-label="anchor" href="#automatic-flagging"></a>
</h3>
<div class="section level4">
<h4 id="flagging-variables">Flagging variables<a class="anchor" aria-label="anchor" href="#flagging-variables"></a>
</h4>
<p>The <code>icd_dat</code> dataset of the <code>WAACHShelp</code>
package has a suite of flags that can be “automatically” flagged in the
morbidity dataset.</p>
<p>This dataset contains the variable name, and the parameters to search
across ICD codes (via <code><a href="../reference/val_filt.html">WAACHShelp::val_filt</a></code>).</p>
<p>To explore this, let’s load the package data:</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="va">icd_dat</span>, package <span class="op">=</span> <span class="st">"WAACHShelp"</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">icd_dat</span><span class="op">)</span></span>
<span><span class="co">#&gt;   num     var broad_type           classification letter lower    upper</span></span>
<span><span class="co">#&gt; 1   1 MH_morb  diagnosis      principal diagnosis      F     0  99.9999</span></span>
<span><span class="co">#&gt; 2   2 MH_morb  diagnosis      principal diagnosis          290 319.9999</span></span>
<span><span class="co">#&gt; 3   1 MH_morb      ediag     additional diagnoses      F     0  99.9999</span></span>
<span><span class="co">#&gt; 4   2 MH_morb      ediag     additional diagnoses          290 319.9999</span></span>
<span><span class="co">#&gt; 5   1 MH_morb      ecode external cause of injury      E   950 959.9999</span></span>
<span><span class="co">#&gt; 6   2 MH_morb      ecode external cause of injury      X    60  84.9999</span></span></code></pre></div>
<p>The full set of flags is printed below:</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/unique.html" class="external-link">unique</a></span><span class="op">(</span><span class="va">icd_dat</span><span class="op">$</span><span class="va">var</span><span class="op">)</span></span>
<span><span class="co">#&gt;  [1] "MH_morb"         "Sub_morb"        "Poison_morb"     "Sub_poison_morb"</span></span>
<span><span class="co">#&gt;  [5] "Alc_morb"        "Tob_morb"        "Opioid_morb"     "Cann_morb"      </span></span>
<span><span class="co">#&gt;  [9] "Sed_morb"        "Coc_morb"        "Stim_morb"       "Hall_morb"      </span></span>
<span><span class="co">#&gt; [13] "Solv_morb"       "Multdrug_morb"   "SH_morb"</span></span></code></pre></div>
</div>
<div class="section level4">
<h4 id="applying-flags">Applying flags<a class="anchor" aria-label="anchor" href="#applying-flags"></a>
</h4>
<p>Applying the function in these circumstances is simple.</p>
<p>Let’s create the following flag, where we:</p>
<ol style="list-style-type: decimal">
<li>Want to flag at a visit-level (i.e., not collapsed to a person
level).</li>
<li>Do not want to filter based on age.</li>
</ol>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/icd_morb_flag.html">icd_morb_flag</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">morb_dat</span>, </span>
<span>              flag_category <span class="op">=</span> <span class="st">"MH_morb"</span><span class="op">)</span></span></code></pre></div>
</div>
</div>
<div class="section level3">
<h3 id="manual-flagging">Manual flagging<a class="anchor" aria-label="anchor" href="#manual-flagging"></a>
</h3>
<p>This is where the bulk of the function’s flexibility lies.</p>
<p>We will present a couple more through examples, compared to the help
of the package.</p>
<p>This involves specifying <code>flag_category = "Other"</code>, and
then specifying a diagnosis type (<code>diag_type</code>) to search
across. <code>diag_type</code> can take on 4 distinct values</p>
<ol style="list-style-type: decimal">
<li>
<code>"prinicipal diagnosis"</code> – Search across principal
diagnosis variable (morbidity data must contain <code>diag</code> which
represents principal diagnosis field).</li>
<li>
<code>"additional diagnoses"</code> – Search across ALL additional
diagnoses variables (morbidity data must contain
<code>ediag1</code>–<code>ediag20</code> Which represent all additional
diagnosis fields).</li>
<li>
<code>"external cause of injury"</code> – Search across ALL external
cause of injury variables (morbiditiy data must contain
<code>ecode1</code>–<code>ecode4</code> which represent all external
cause of injury fields).</li>
<li>
<code>"custom"</code> – Other!</li>
</ol>
<div class="section level4">
<h4 id="example-1-basic-flag-creation">Example 1: Basic flag creation<a class="anchor" aria-label="anchor" href="#example-1-basic-flag-creation"></a>
</h4>
<p>Let’s re-create the <code>MH_morb</code> flag with manual
flagging.</p>
<div class="section level5">
<h5 id="attempt-1-without-specifying-diag_typecustom">Attempt 1: without specifying <code>diag_type="custom"</code><a class="anchor" aria-label="anchor" href="#attempt-1-without-specifying-diag_typecustom"></a>
</h5>
<p>We must specify the boundaries to search across for each of the
“principal diagnosis”, “additional diagnoses”, “external cause of
injury” variable groups. This is fed into the
<code>diag_type_custom_params</code> argument. The data structure must
be a <strong>list of lists</strong>.</p>
<p>The list of lists must have search keys equal to “letter” (letter of
ICD code, empty string if strictly numeric), “lower” (lower bound of
numeric element), “upper” (upper bound of numeric element).</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/icd_morb_flag.html">icd_morb_flag</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">morb_dat</span>,</span>
<span>              flag_category <span class="op">=</span> <span class="st">"Other"</span>,</span>
<span>              diag_type <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"principal diagnosis"</span>, <span class="st">"additional diagnoses"</span>, <span class="st">"external cause of injury"</span><span class="op">)</span>,</span>
<span>              diag_type_custom_params <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="st">"principal diagnosis"</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>letter <span class="op">=</span> <span class="st">"F"</span>, </span>
<span>                                                                               lower <span class="op">=</span> <span class="fl">0</span>, </span>
<span>                                                                               upper <span class="op">=</span> <span class="fl">99.9999</span><span class="op">)</span>,</span>
<span>                                                                          <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>letter <span class="op">=</span> <span class="st">""</span> , </span>
<span>                                                                               lower <span class="op">=</span> <span class="fl">290</span>, </span>
<span>                                                                               upper <span class="op">=</span> <span class="fl">319.9999</span><span class="op">)</span><span class="op">)</span>,</span>
<span>                                             <span class="st">"additional diagnoses"</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>letter <span class="op">=</span> <span class="st">"F"</span>, </span>
<span>                                                                                lower <span class="op">=</span> <span class="fl">0</span>, </span>
<span>                                                                                upper <span class="op">=</span> <span class="fl">99.9999</span><span class="op">)</span>,</span>
<span>                                                                           <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>letter <span class="op">=</span> <span class="st">""</span>, </span>
<span>                                                                                lower <span class="op">=</span> <span class="fl">290</span>, </span>
<span>                                                                                upper <span class="op">=</span> <span class="fl">319.9999</span><span class="op">)</span><span class="op">)</span>,</span>
<span>                                             <span class="st">"external cause of injury"</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>letter <span class="op">=</span> <span class="st">"E"</span>, </span>
<span>                                                                                    lower <span class="op">=</span> <span class="fl">950</span>, </span>
<span>                                                                                    upper <span class="op">=</span> <span class="fl">959.9999</span><span class="op">)</span>,</span>
<span>                                                                               <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>letter <span class="op">=</span> <span class="st">"X"</span>, </span>
<span>                                                                                    lower <span class="op">=</span> <span class="fl">60</span>, </span>
<span>                                                                                    upper <span class="op">=</span> <span class="fl">84.9999</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>,</span>
<span>              flag_other_varname <span class="op">=</span> <span class="st">"MH_morb_custom"</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level5">
<h5 id="attempt-2-specifying-diag_typecustom">Attempt 2: specifying <code>diag_type="custom"</code><a class="anchor" aria-label="anchor" href="#attempt-2-specifying-diag_typecustom"></a>
</h5>
<p>This specific example is a little (a lot) more tedious, but we will
still proceed for illustrative purposes. In this instance, we must
individually specify the search parameters for every variable.</p>
<p>Therefore, we must set <code>diag_type="custom"</code>, and name the
variables we would like to search across using the
<code>diag_type_custom_vars</code> argument.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Set search parameters for principal, additional diagnoses</span></span>
<span><span class="va">diag_ediag_params</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>letter <span class="op">=</span> <span class="st">"F"</span>, </span>
<span>                               lower <span class="op">=</span> <span class="fl">0</span>, </span>
<span>                               upper <span class="op">=</span> <span class="fl">99.9999</span><span class="op">)</span>,</span>
<span>                          <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>letter <span class="op">=</span> <span class="st">""</span> , </span>
<span>                               lower <span class="op">=</span> <span class="fl">290</span>, </span>
<span>                               upper <span class="op">=</span> <span class="fl">319.9999</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Set search parameters for ecode variables</span></span>
<span><span class="va">ecode_params</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>letter <span class="op">=</span> <span class="st">"E"</span>, </span>
<span>                          lower <span class="op">=</span> <span class="fl">950</span>, </span>
<span>                          upper <span class="op">=</span> <span class="fl">959.9999</span><span class="op">)</span>,</span>
<span>                     <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>letter <span class="op">=</span> <span class="st">"X"</span>, </span>
<span>                          lower <span class="op">=</span> <span class="fl">60</span>, </span>
<span>                          upper <span class="op">=</span> <span class="fl">84.9999</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span></span>
<span><span class="fu"><a href="../reference/icd_morb_flag.html">icd_morb_flag</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">morb_dat</span>,</span>
<span>              flag_category <span class="op">=</span> <span class="st">"Other"</span>,</span>
<span>              diag_type <span class="op">=</span> <span class="st">"custom"</span>,</span>
<span>              diag_type_custom_vars <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"diag"</span>,                <span class="co"># Principal diagnosis variables</span></span>
<span>                                        <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">"ediag"</span>, <span class="fl">1</span><span class="op">:</span><span class="fl">20</span><span class="op">)</span>, <span class="co"># Additional diagnosis variables</span></span>
<span>                                        <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">"ecode"</span>, <span class="fl">1</span><span class="op">:</span><span class="fl">4</span><span class="op">)</span>   <span class="co"># External cause of injury variables</span></span>
<span>                                        <span class="op">)</span>,</span>
<span>              diag_type_custom_params <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="st">"diag"</span> <span class="op">=</span> <span class="va">diag_ediag_params</span>,</span>
<span>                                             <span class="fu"><a href="https://rdrr.io/r/stats/setNames.html" class="external-link">setNames</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="va">diag_ediag_params</span><span class="op">)</span>, <span class="fl">20</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">"ediag"</span>, <span class="fl">1</span><span class="op">:</span><span class="fl">20</span><span class="op">)</span><span class="op">)</span>,</span>
<span>                                             <span class="fu"><a href="https://rdrr.io/r/stats/setNames.html" class="external-link">setNames</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="va">ecode_params</span><span class="op">)</span>, <span class="fl">20</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">"ecode"</span>, <span class="fl">1</span><span class="op">:</span><span class="fl">4</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>,</span>
<span>              flag_other_varname <span class="op">=</span> <span class="st">"MH_morb_custom"</span><span class="op">)</span></span></code></pre></div>
</div>
</div>
<div class="section level4">
<h4 id="example-2-combining-diag_type-values">Example 2: Combining <code>diag_type</code> values<a class="anchor" aria-label="anchor" href="#example-2-combining-diag_type-values"></a>
</h4>
<p>We can flexibly specify <code>diag_type</code>—we can search across
any pre-defined group (principal diagnosis, additional diagnoses,
external cause of injury) <em>in addition to</em> a (set of) custom
variable(s).</p>
<p>For example, if we would like to search across all additional
diagnoses variables, in addition to a variable named
<code>dagger</code>, we can do this:</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/icd_morb_flag.html">icd_morb_flag</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">morb_dat</span>,</span>
<span>              flag_category <span class="op">=</span> <span class="st">"Other"</span>,</span>
<span>              diag_type <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"additional diagnoses"</span>, <span class="st">"custom"</span><span class="op">)</span>,</span>
<span>              diag_type_custom_vars <span class="op">=</span> <span class="st">"dagger"</span>,</span>
<span>              diag_type_custom_params <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="st">"additional diagnoses"</span> <span class="op">=</span> <span class="va">diag_ediag_params</span>,</span>
<span>                                             <span class="st">"dagger"</span> <span class="op">=</span> <span class="va">diag_ediag_params</span><span class="op">)</span>,</span>
<span>              flag_other_varname <span class="op">=</span> <span class="st">"MH_morb_custom"</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level4">
<h4 id="example-3-specifying-person_summary">Example 3: Specifying <code>person_summary</code><a class="anchor" aria-label="anchor" href="#example-3-specifying-person_summary"></a>
</h4>
<p>TRUE/FALSE argument on whether to collapse records to a person level,
instead of an admission (record) level.</p>
<p>The summary works such that if <em>any</em> record for an individual
is flagged “yes”, then the collapsed record for that individual is
“yes”. Otherwise, if <em>all</em> records for an individual are flagged
“no”, then the collapsed record for that individual is “no”.</p>
<p>The number of rows in the flagged data set when
<code>person_summary = TRUE</code> correspond to the number of unique
values of the <code>id_var</code> (e.g., rootnum, NEWUID).</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/icd_morb_flag.html">icd_morb_flag</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">morb_dat</span>, </span>
<span>              flag_category <span class="op">=</span> <span class="st">"MH_morb"</span>,</span>
<span>              person_summary <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level4">
<h4 id="example-4-flagging-records-below-strictly-below-a-certain-age">Example 4: Flagging records below strictly below a certain age<a class="anchor" aria-label="anchor" href="#example-4-flagging-records-below-strictly-below-a-certain-age"></a>
</h4>
<p>We can create a flag based on an individual’s admission age. This
requires a “DOBmap” file to be specified, so an age can actuall be
calculated.</p>
<p>This flags records if the record occurred strictly below the age
specified (e.g., if individual is strictly below 18). Therefore, for a
non-missing flag to be returned, both an individual’s <em>date of
birth</em> and <em>date of admission</em> must exist.</p>
<p><strong>Note:</strong></p>
<ul>
<li>The DOB variable in the DOBmap (if not called <code>dob</code>) can
be specified using the <code>dob_var</code> argument.</li>
<li>The admission date variable in the morbidity file (if not called
<code>subadm</code>) can be specified using the
<code>morb_date_var</code> argument.</li>
</ul>
<p>All we have to do is specify <code>under_age = TRUE</code> and and a
numeric <code>age</code> value (default is 18).</p>
<p>Let’s create the following flag:</p>
<ol style="list-style-type: decimal">
<li>Only flag records under 25.</li>
<li>Explore what this looks like depending on whether
<code>person_summary</code> is TRUE or FALSE.</li>
</ol>
<div class="section level5">
<h5 id="attempt-1-if-person_summary-false">Attempt 1: if <code>person_summary = FALSE</code><a class="anchor" aria-label="anchor" href="#attempt-1-if-person_summary-false"></a>
</h5>
<p>If <code>person_summary = F</code>, we are returned with two flag
variables: one with the variable name and one with the variable name and
“_under{age}” suffix.</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Creates variables `MH_morb`, `MH_morb_under18`</span></span>
<span><span class="fu"><a href="../reference/icd_morb_flag.html">icd_morb_flag</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">morb_dat</span>,</span>
<span>              dobmap <span class="op">=</span> <span class="va">dobmap_dat</span>,</span>
<span>              flag_category <span class="op">=</span> <span class="st">"MH_morb"</span>,</span>
<span>              under_age <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>              age <span class="op">=</span> <span class="fl">25</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level5">
<h5 id="attempt-2-if-person_summary-true">Attempt 2: if <code>person_summary = TRUE</code><a class="anchor" aria-label="anchor" href="#attempt-2-if-person_summary-true"></a>
</h5>
<p>If <code>person_summary = T</code>, we are returned only with one
flag variable for the under age group.</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Creates variable `MH_morb_under18`</span></span>
<span><span class="fu"><a href="../reference/icd_morb_flag.html">icd_morb_flag</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">morb_dat</span>,</span>
<span>              dobmap <span class="op">=</span> <span class="va">dobmap_dat</span>,</span>
<span>              flag_category <span class="op">=</span> <span class="st">"MH_morb"</span>,</span>
<span>              under_age <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>              age <span class="op">=</span> <span class="fl">25</span>,</span>
<span>              person_summary <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
</div>
</div>
</div>
</div>
<div class="section level2">
<h2 id="conclusion">Conclusion<a class="anchor" aria-label="anchor" href="#conclusion"></a>
</h2>
<p>The <code>icd_morb_flag</code> function prototype is useful for
consistently flagging morbidity (or other) data sets across a
pre-specified range of ICD values—aiding reproducibility across analysts
and across tasks. It does not require converted or necessarily
consistent ICD codes (i.e., does not require ICD-9, ICD-10 formatted
codes), and simply searches across the codes that exist in the data
set.</p>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

      </div>

</div>



      <footer><div class="copyright">
  <p></p>
<p>Developed by Zac Dempsey.</p>
</div>

<div class="pkgdown">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.3.</p>
</div>

      </footer>
</div>






  </body>
</html>
